<!DOCTYPE html>
<html lang="es">

<head>
  <script>
    /**
     * RDV News App - Password Protection
     * Simple but effective protection for single-user news operation
     */
    (function () {
      'use strict';

      // Configuration
      const CONFIG = {
        password: 'RDV-News-2024!', // Change this to your preferred password
        sessionKey: 'rdv-news-authenticated',
        sessionDuration: 8 * 60 * 60 * 1000, // 8 hours in milliseconds
        maxAttempts: 3
      };

      // Check if already authenticated
      function isAuthenticated() {
        const authData = sessionStorage.getItem(CONFIG.sessionKey);

        if (!authData) return false;

        try {
          const data = JSON.parse(authData);
          const now = Date.now();

          // Check if session has expired
          if (now > data.expiry) {
            sessionStorage.removeItem(CONFIG.sessionKey);
            return false;
          }

          return true;
        } catch (error) {
          sessionStorage.removeItem(CONFIG.sessionKey);
          return false;
        }
      }

      // Set authentication
      function setAuthenticated() {
        const expiry = Date.now() + CONFIG.sessionDuration;
        const authData = {
          authenticated: true,
          timestamp: Date.now(),
          expiry: expiry
        };

        sessionStorage.setItem(CONFIG.sessionKey, JSON.stringify(authData));
      }

      // Get failed attempts count
      function getFailedAttempts() {
        const attempts = localStorage.getItem('rdv-failed-attempts');
        return attempts ? parseInt(attempts) : 0;
      }

      // Increment failed attempts
      function incrementFailedAttempts() {
        const attempts = getFailedAttempts() + 1;
        localStorage.setItem('rdv-failed-attempts', attempts.toString());
        return attempts;
      }

      // Reset failed attempts
      function resetFailedAttempts() {
        localStorage.removeItem('rdv-failed-attempts');
      }

      // Show login prompt
      function showLogin() {
        const attempts = getFailedAttempts();

        if (attempts >= CONFIG.maxAttempts) {
          alert('Demasiados intentos fallidos. Acceso bloqueado.');
          window.location.href = 'https://google.com';
          return;
        }

        const remainingAttempts = CONFIG.maxAttempts - attempts;
        const message = attempts > 0
          ? `Contrase√±a incorrecta. Te quedan ${remainingAttempts} intentos.\n\nIngresa la contrase√±a para RDV News:`
          : 'Acceso restringido a RDV News\n\nIngresa la contrase√±a:';

        const password = prompt(message);

        if (password === null) {
          // User cancelled
          window.location.href = 'https://google.com';
          return;
        }

        if (password === CONFIG.password) {
          setAuthenticated();
          resetFailedAttempts();
          showWelcomeMessage();
        } else {
          const newAttempts = incrementFailedAttempts();

          if (newAttempts >= CONFIG.maxAttempts) {
            alert('Demasiados intentos fallidos. Acceso bloqueado.');
            window.location.href = 'https://google.com';
          } else {
            showLogin(); // Try again
          }
        }
      }

      // Show welcome message
      function showWelcomeMessage() {
        console.log('‚úÖ RDV News - Acceso autorizado');

        // Optional: Show toast notification if showToast function exists
        setTimeout(() => {
          if (typeof showToast === 'function') {
            showToast('‚úÖ Sesi√≥n iniciada correctamente', 'success');
          }
        }, 1000);
      }

      // Add logout functionality
      function addLogoutButton() {
        document.addEventListener('DOMContentLoaded', function () {
          // Create logout button
          const logoutBtn = document.createElement('button');
          logoutBtn.innerHTML = 'üîí Cerrar Sesi√≥n';
          logoutBtn.style.cssText = `
              position: fixed;
              top: 10px;
              right: 10px;
              background: #dc3545;
              color: white;
              border: none;
              padding: 8px 12px;
              border-radius: 4px;
              cursor: pointer;
              z-index: 9999;
              font-size: 12px;
              font-family: Arial, sans-serif;
            `;

          logoutBtn.onclick = function () {
            if (confirm('¬øEst√°s seguro que quieres cerrar sesi√≥n?')) {
              sessionStorage.removeItem(CONFIG.sessionKey);
              location.reload();
            }
          };

          document.body.appendChild(logoutBtn);
        });
      }

      // Initialize protection
      function init() {
        if (!isAuthenticated()) {
          showLogin();
        } else {
          showWelcomeMessage();
          addLogoutButton();
        }
      }

      // Run immediately
      init();

    })();
  </script>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>RDV Image Generator Pro</title>
  <meta name="description" content="Professional social media image generator for Radio del Volga news content" />
  <meta name="keywords" content="image generator, social media, news, rdv, canvas" />
  <meta name="author" content="Radio del Volga" />
  <!-- Add this CSP meta tag to allow your API calls -->
  <!-- REPLACE the existing CSP meta tag with this updated version: -->
  <!-- More permissive CSP that allows all HTTPS APIs -->
  <!-- REPLACE the existing CSP meta tag with this updated version: -->
  <meta http-equiv="Content-Security-Policy" content="
    default-src 'self';
    connect-src 'self' https://rdv-news-api.vercel.app https://*.vercel.app https://cdnjs.cloudflare.com https://api.airtable.com https://*.airtable.com https://hooks.slack.com https://api.allorigins.win https://cors-anywhere.herokuapp.com https://proxy.cors.sh https://corsproxy.io https://crossorigin.me https://hook.us1.make.com https://api.cloudinary.com https://*.cloudinary.com https://graph.facebook.com https://*.facebook.com https://graph.instagram.com https://*.instagram.com;
    script-src 'self' 'unsafe-inline' 'unsafe-eval' https://cdnjs.cloudflare.com https://fonts.googleapis.com;
    style-src 'self' 'unsafe-inline' https://fonts.googleapis.com https://fonts.gstatic.com https://cdnjs.cloudflare.com;
    font-src 'self' https://fonts.gstatic.com https://fonts.googleapis.com;
    img-src 'self' data: blob: https: http:;
    frame-src 'none';
    object-src 'none';
  ">

  <!-- Favicon -->
  <link rel="icon" href="assets/images/logos/rdv-logo.svg" type="image/svg+xml" />
  <link rel="apple-touch-icon" href="assets/images/logos/rdv-logo.svg" />

  <!-- External Dependencies -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/dom-to-image/2.6.0/dom-to-image.min.js"></script>

  <!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link
    href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&family=Playfair+Display:wght@400;500;600;700;800;900&family=Roboto:wght@300;400;500;700;900&display=swap"
    rel="stylesheet" />

  <!-- Local Styles -->
  <link rel="stylesheet" href="css/base.css" />
  <link rel="stylesheet" href="css/components.css" />
  <link rel="stylesheet" href="css/templates.css" />
  <link rel="stylesheet" href="css/responsive.css" />

  <!-- Theme Styles -->
  <link rel="stylesheet" href="assets/styles/themes/default.css" />
  <link rel="stylesheet" href="assets/styles/animations/entrance.css" />
  <link rel="stylesheet" href="assets/styles/animations/floating.css" />

  <!-- PWA Manifest -->
  <link rel="manifest" href="manifest.json" />
  <meta name="theme-color" content="#667eea" />
</head>

<body>
  <!-- Loading Screen -->
  <div id="loadingScreen" class="loading-screen">
    <div class="loading-content">
      <div class="loading-logo">
        <img src="assets/images/logos/rdv-logo.svg" alt="RDV" />
      </div>
      <div class="loading-text">Cargando RDV Image Generator...</div>
      <div class="loading-bar">
        <div class="loading-progress"></div>
      </div>
    </div>
  </div>

  <!-- Header -->
  <header class="header" id="mainHeader">
    <div class="header-content">
      <div class="logo">
        <img src="assets/images/logos/rdv-logo.svg" alt="RDV" width="40" height="40" />
        <span>Image Generator Pro</span>
        <span class="version-badge">v1.0</span>
      </div>
      <div class="header-actions">
        <button class="btn-secondary" onclick="exportSettings()" title="Exportar configuraci√≥n">
          <span>‚öôÔ∏è</span>
          <span>Exportar Config</span>
        </button>
        <button class="btn-secondary" onclick="importSettings()" title="Importar configuraci√≥n">
          <span>üì•</span>
          <span>Importar Config</span>
        </button>
        <button class="btn-secondary" onclick="showHelp()" title="Ayuda">
          <span>‚ùì</span>
          <span>Ayuda</span>
        </button>
      </div>
    </div>
  </header>

  <!-- Main Container -->
  <div class="main-container" id="mainContainer">
    <!-- Control Panel -->
    <aside class="control-panel" id="controlPanel">
      <!-- Platform & Template Section -->
      <div class="panel-section">
        <h3>üéØ Plataforma & Plantilla</h3>

        <!-- Platform Selector -->
        <div class="platform-selector" id="platformSelector">
          <button class="platform-btn active" data-platform="instagram" title="Instagram">
            <span class="platform-icon">üì∑</span>
            <span>Instagram</span>
          </button>
          <button class="platform-btn" data-platform="facebook" title="Facebook">
            <span class="platform-icon">üë•</span>
            <span>Facebook</span>
          </button>
          <button class="platform-btn" data-platform="twitter" title="Twitter">
            <span class="platform-icon">üê¶</span>
            <span>Twitter</span>
          </button>
          <button class="platform-btn" data-platform="universal" title="Universal">
            <span class="platform-icon">üåê</span>
            <span>Universal</span>
          </button>
        </div>

        <!-- Template Selector -->
        <div class="template-selector" id="templateSelector">
          <!-- Templates will be loaded dynamically -->
          <!-- Template Selector for Instagram -->
          <div class="instagram-templates" id="instagramTemplates" style="display: block">
            <button class="template-btn active" data-template="story" data-platform="instagram"
              onclick="selectInstagramTemplate('story')">
              <div class="template-preview">
                <div class="template-ratio" style="
                      aspect-ratio: 9/16;
                      background: linear-gradient(
                        135deg,
                        #667eea 0%,
                        #764ba2 100%
                      );
                    "></div>
              </div>
              <div class="template-info">
                <h4>üì± Story</h4>
                <span>1080√ó1920 ‚Ä¢ 9:16</span>
              </div>
            </button>

            <button class="template-btn" data-template="post" data-platform="instagram"
              onclick="selectInstagramTemplate('post')">
              <div class="template-preview">
                <div class="template-ratio" style="
                      aspect-ratio: 1/1;
                      background: linear-gradient(
                        135deg,
                        #ff416c 0%,
                        #ff4b2b 100%
                      );
                    "></div>
              </div>
              <div class="template-info">
                <h4>üü¶ Post</h4>
                <span>1080√ó1080 ‚Ä¢ 1:1</span>
              </div>
            </button>

            <button class="template-btn" data-template="reel-cover" data-platform="instagram"
              onclick="selectInstagramTemplate('reel-cover')">
              <div class="template-preview">
                <div class="template-ratio" style="
                      aspect-ratio: 9/16;
                      background: linear-gradient(
                        135deg,
                        #4facfe 0%,
                        #00f2fe 100%
                      );
                    "></div>
              </div>
              <div class="template-info">
                <h4>üé¨ Reel Cover</h4>
                <span>1080√ó1920 ‚Ä¢ 9:16</span>
              </div>
            </button>
            <button class="template-btn" data-template="portrait" onclick="selectInstagramTemplate('portrait')">
              üì± Portrait Post (4:5)
            </button>
            <!-- Add this near your other control buttons -->
            <div class="flyer-controls" style="margin: 15px 0; display: flex; align-items: center; gap: 12px;">
              <button id="flyerModeBtn" class="flyer-toggle-btn" onclick="toggleFlyerMode()" style="
                padding: 10px 18px;
                background: linear-gradient(45deg, #faf6ef, #ffffff);
                color: #292929;
                border: 2px solid #ff0808;
                border-radius: 10px;
                font-size: 13px;
                font-weight: 600;
                cursor: pointer;
                transition: all 0.3s ease;
                position: relative;
                overflow: hidden;
                min-width: 140px;
              ">
                <span id="flyerBtnIcon">üé®</span>
                <span id="flyerBtnText">Modo Flyer</span>
              </button>

              <span style="
                font-size: 12px; 
                color: #666; 
                font-style: italic;
                opacity: 0.8;
              ">
                Suaviza flyers con gradiente profesional
              </span>
            </div>

          </div>

          <!-- Add this near your other control buttons -->
          <div class="logo-selector" style="margin: 15px 0; display: flex; align-items: center; gap: 12px;">
            <label for="logoSelect" style="
              font-size: 13px;
              font-weight: 600;
              color: #292929;
              min-width: 60px;
            ">Logo:</label>

            <select id="logoSelect" onchange="updateTemplateLogo()" style="
              padding: 8px 12px;
              border: 2px solid #ff0808;
              border-radius: 8px;
              background: linear-gradient(45deg, #faf6ef, #ffffff);
              color: #292929;
              font-size: 12px;
              font-weight: 600;
              cursor: pointer;
              min-width: 140px;
            ">
              <option value="auto">üéØ Auto (recomendado)</option>
              <option value="rdv-black.svg">‚ö´ Negro</option>
              <option value="rdv-white.svg">‚ö™ Blanco</option>
              <option value="rdv-red.svg">üî¥ Rojo</option>
            </select>

            <span style="
              font-size: 11px; 
              color: #666; 
              font-style: italic;
              opacity: 0.8;
            ">
              Auto selecciona el mejor logo para cada template
            </span>
          </div>



          <!-- Facebook Templates Section -->
          <div id="facebookTemplates" class="template-section" style="display: none;">
            <h3>üìò Facebook Templates</h3>
            <div class="template-grid">
              <button class="template-btn" data-platform="facebook" data-template="post"
                onclick="selectFacebookTemplate('post')">
                <div class="template-preview">
                  <div class="template-icon">üìò</div>
                  <div class="template-info">
                    <div class="template-name">Facebook Post</div>
                    <div class="template-size">1200 √ó 630</div>
                  </div>
                </div>
              </button>

              <button class="template-btn" data-platform="facebook" data-template="cover"
                onclick="selectFacebookTemplate('cover')">
                <div class="template-preview">
                  <div class="template-icon">üéØ</div>
                  <div class="template-info">
                    <div class="template-name">Facebook Cover</div>
                    <div class="template-size">1640 √ó 859</div>
                  </div>
                </div>
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- Content Section -->
      <div class="panel-section">
        <h3>üìù Contenido</h3>

        <div class="form-group">
          <label for="recordId">ID de Registro Airtable</label>
          <div class="input-group">
            <input type="text" id="recordId" placeholder="Ingresa el ID del registro" autocomplete="off" />
            <button class="btn-icon" onclick="loadFromAirtable()" title="Cargar desde Airtable">
              üì•
            </button>
          </div>
          <small class="form-help">Opcional: Carga autom√°tica desde Airtable</small>
        </div>

        <div class="form-group">
          <label for="title">T√≠tulo</label>
          <textarea id="title" rows="2" placeholder="Ingresa el t√≠tulo del art√≠culo" maxlength="200">
Argentina lidera innovaci√≥n en tecnolog√≠a sustentable</textarea>
          <div class="char-counter">
            <span id="titleCounter">0</span>/200 caracteres
          </div>
        </div>

        <div class="form-group">
          <label for="excerpt">Resumen</label>
          <textarea id="excerpt" rows="3" placeholder="Ingresa el resumen del art√≠culo" maxlength="500">
Un nuevo estudio revela que Argentina se posiciona como l√≠der regional en el desarrollo de tecnolog√≠as sustentables, con inversiones que superan los USD 2.000 millones.</textarea>
          <div class="char-counter">
            <span id="excerptCounter">0</span>/500 caracteres
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="source">Fuente</label>
            <input type="text" id="source" placeholder="Nombre de la fuente" value="RDV Noticias" maxlength="50" />
          </div>

          <div class="form-group">
            <label for="author">Autor</label>
            <input type="text" id="author" placeholder="Nombre del autor" value="Redacci√≥n RDV" maxlength="50" />
          </div>
        </div>

        <div class="form-group">
          <label for="tags">Etiquetas</label>
          <input type="text" id="tags" placeholder="etiqueta1, etiqueta2, etiqueta3"
            value="tecnolog√≠a, sustentabilidad, argentina" maxlength="100" />
          <small class="form-help">Separadas por comas</small>
        </div>

        <div class="form-group">
          <label for="category">Categor√≠a</label>
          <select id="category">
            <option value="general">General</option>
            <option value="politica">Pol√≠tica</option>
            <option value="economia">Econom√≠a</option>
            <option value="tecnologia" selected>Tecnolog√≠a</option>
            <option value="deportes">Deportes</option>
            <option value="cultura">Cultura</option>
            <option value="internacionales">Internacionales</option>
            <option value="sociedad">Sociedad</option>
          </select>
        </div>
      </div>

      <!-- Design Section -->
      <div class="panel-section">
        <h3>üé® Dise√±o</h3>

        <div class="form-group">
          <label>Tema de Color</label>
          <div class="color-themes" id="colorThemes">
            <div class="color-theme active" data-theme="default">
              <div class="color-preview" style="
                    background: linear-gradient(
                      135deg,
                      #667eea 0%,
                      #764ba2 100%
                    );
                  "></div>
              <span>Default</span>
            </div>
            <div class="color-theme" data-theme="news">
              <div class="color-preview" style="
                    background: linear-gradient(
                      135deg,
                      #ff416c 0%,
                      #ff4b2b 100%
                    );
                  "></div>
              <span>Noticias</span>
            </div>
            <div class="color-theme" data-theme="tech">
              <div class="color-preview" style="
                    background: linear-gradient(
                      135deg,
                      #4facfe 0%,
                      #00f2fe 100%
                    );
                  "></div>
              <span>Tech</span>
            </div>
            <div class="color-theme" data-theme="business">
              <div class="color-preview" style="
                    background: linear-gradient(
                      135deg,
                      #43e97b 0%,
                      #38f9d7 100%
                    );
                  "></div>
              <span>Business</span>
            </div>
            <div class="color-theme" data-theme="sports">
              <div class="color-preview" style="
                    background: linear-gradient(
                      135deg,
                      #fa709a 0%,
                      #fee140 100%
                    );
                  "></div>
              <span>Deportes</span>
            </div>
            <div class="color-theme" data-theme="culture">
              <div class="color-preview" style="
                    background: linear-gradient(
                      135deg,
                      #a8edea 0%,
                      #fed6e3 100%
                    );
                  "></div>
              <span>Cultura</span>
            </div>
          </div>
        </div>

        <div class="form-group">
          <label for="backgroundImage">Imagen de Fondo</label>
          <div class="input-group">
            <input type="text" id="backgroundImage" placeholder="https://ejemplo.com/imagen.jpg" />
            <button class="btn-icon" onclick="openImagePicker()" title="Explorar im√°genes">
              üñºÔ∏è
            </button>
            <button class="btn-icon" onclick="uploadImage()" title="Subir imagen">
              üì§
            </button>
          </div>
          <input type="file" id="imageUpload" accept="image/*" style="display: none"
            onchange="handleImageUpload(this)" />
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="fontStyle">Estilo de Fuente</label>
            <select id="fontStyle">
              <option value="inter">Inter (Moderno)</option>
              <option value="playfair">Playfair Display (Elegante)</option>
              <option value="roboto">Roboto (Limpio)</option>
              <option value="custom">Fuente Personalizada</option>
            </select>
          </div>

          <div class="form-group">
            <label for="animationStyle">Estilo de Animaci√≥n</label>
            <select id="animationStyle">
              <option value="none">Ninguna</option>
              <option value="fade">Fade In</option>
              <option value="slide">Slide In</option>
              <option value="float">Elementos Flotantes</option>
              <option value="pulse">Efecto Pulse</option>
            </select>
          </div>
        </div>

        <div class="form-group">
          <label for="imageQuality">Calidad de Imagen</label>
          <select id="imageQuality">
            <option value="standard">Est√°ndar (Web)</option>
            <option value="high" selected>Alta (Print)</option>
            <option value="ultra">Ultra (4K)</option>
          </select>
        </div>
      </div>

      <!-- Actions Section -->
      <div class="panel-section">
        <h3>‚ö° Acciones</h3>

        <button class="btn-primary full-width" onclick="updatePreview()" title="Actualizar vista previa">
          üîÑ Actualizar Vista Previa
        </button>

        <button class="btn-primary full-width" onclick="generateImage()" title="Generar imagen">
          üì∑ Generar Imagen
        </button>

        <div class="btn-group">
          <button class="btn-secondary" onclick="generateAll()" title="Generar para todas las plataformas">
            üìä Todas las Plataformas
          </button>
          <button class="btn-secondary" onclick="scheduledGeneration()" title="Programar generaci√≥n">
            ‚è∞ Programar
          </button>
        </div>

        <div class="btn-group">
          <button class="btn-secondary" onclick="uploadToAirtable()" title="Guardar en Airtable">
            ‚òÅÔ∏è Guardar en Airtable
          </button>
          <button class="btn-secondary" onclick="shareToSocial()" title="Compartir directamente">
            üöÄ Compartir Directo
          </button>
        </div>

        <div class="btn-group">
          <button class="btn-secondary" onclick="saveAsTemplate()" title="Guardar como plantilla">
            üíæ Guardar Plantilla
          </button>
          <button class="btn-secondary" onclick="resetForm()" title="Reiniciar formulario">
            üîÑ Reiniciar
          </button>
        </div>

        <!-- Add this to your Actions Section -->
        <div class="btn-group">
          <button class="btn-primary" onclick="shareToInstagramPost()" title="Compartir como Post de Instagram">
            üì∑ Instagram Post
          </button>
          <button class="btn-secondary" onclick="shareToInstagramStory()" title="Compartir como Story de Instagram">
            üì± Instagram Story
          </button>
        </div>

        <div class="btn-group">
          <!-- Add this to your Actions Section in index.html -->
          <button class="btn-primary full-width" onclick="shareToFacebook()" title="Compartir en Facebook">
            üìò Compartir en Facebook
          </button>
        </div>


      </div>

      <!-- Add this after the existing Actions Section buttons -->
      <!-- filepath: /home/zen/Documents/rdv-image-generator/index.html -->

      <!-- DIRECT PUBLISHING SECTION -->
      <div class="panel-subsection">
        <h4>üöÄ Publicaci√≥n Directa</h4>

        <!-- Platform Selection for Publishing -->
        <div class="publish-platforms" id="publishPlatforms">
          <label class="platform-toggle">
            <input type="checkbox" value="instagram" checked />
            <span class="platform-badge instagram">
              <span class="platform-icon">üì∑</span>
              <span>Instagram</span>
            </span>
          </label>

          <label class="platform-toggle">
            <input type="checkbox" value="facebook" checked />
            <span class="platform-badge facebook">
              <span class="platform-icon">üë•</span>
              <span>Facebook</span>
            </span>
          </label>

          <label class="platform-toggle">
            <input type="checkbox" value="twitter" checked />
            <span class="platform-badge twitter">
              <span class="platform-icon">üê¶</span>
              <span>Twitter</span>
            </span>
          </label>
        </div>

        <!-- Publishing Actions -->
        <div class="btn-group">
          <button class="btn-primary" id="publishNowBtn" onclick="publishNow()"
            title="Publicar inmediatamente en plataformas seleccionadas">
            üöÄ Publicar Ahora
          </button>

          <button class="btn-secondary" id="schedulePostBtn" onclick="schedulePost()"
            title="Programar publicaci√≥n para m√°s tarde">
            ‚è∞ Programar
          </button>
        </div>

        <!-- Publishing Status Display -->
        <div class="publish-status" id="publishStatus" style="display: none">
          <h5>üìä Estado de Publicaci√≥n</h5>
          <div class="publish-results" id="publishResults">
            <!-- Publishing results will appear here -->
          </div>
        </div>

        <!-- Scheduling Options (Hidden by default) -->
        <div class="schedule-options" id="scheduleOptions" style="display: none">
          <div class="form-group">
            <label for="scheduleDateTime">Fecha y hora de publicaci√≥n:</label>
            <input type="datetime-local" id="scheduleDateTime" min="" />
          </div>

          <div class="btn-group">
            <button class="btn-primary" onclick="confirmScheduledPost()">
              ‚úÖ Confirmar Programaci√≥n
            </button>
            <button class="btn-secondary" onclick="cancelScheduling()">
              ‚ùå Cancelar
            </button>
          </div>
        </div>
      </div>
    </aside>

    <!-- Preview Area -->
    <main class="preview-area" id="previewArea">
      <div class="preview-header">
        <div class="preview-info">
          <span class="platform-name" id="currentPlatform">Instagram</span>
          <span class="template-name" id="currentTemplate">Story Template</span>
          <span class="dimensions" id="currentDimensions">1080 √ó 1920</span>
        </div>

        <div class="preview-actions">
          <button class="btn-icon" onclick="zoomIn()" title="Acercar">
            üîç+
          </button>
          <button class="btn-icon" onclick="zoomOut()" title="Alejar">
            üîç-
          </button>
          <button class="btn-icon" onclick="resetZoom()" title="Restablecer zoom">
            ‚ö°
          </button>
          <button class="btn-icon" onclick="toggleFullscreen()" title="Pantalla completa">
            ‚õ∂
          </button>
          <button class="btn-icon" onclick="togglePreviewMode()" title="Modo de vista previa">
            üëÅÔ∏è
          </button>
        </div>
      </div>

      <div class="preview-container" id="previewContainer">
        <div class="canvas-wrapper" id="canvasWrapper">
          <div id="canvas" class="template-canvas">
            <!-- Template content will be loaded here -->
            <div class="placeholder-content">
              <div class="placeholder-icon">üé®</div>
              <h3>Selecciona una plantilla para comenzar</h3>
              <p>Elige una plataforma y plantilla para ver la vista previa</p>
            </div>
          </div>
        </div>
      </div>

      <div class="preview-footer">
        <div class="generation-status">
          <span class="status-indicator ready" id="statusIndicator"></span>
          <span id="statusText">Listo para generar</span>
        </div>

        <div class="quick-actions">
          <button class="btn-quick" onclick="copyImageToClipboard()" title="Copiar al portapapeles">
            üìã Copiar
          </button>
          <button class="btn-quick" onclick="downloadImage()" title="Descargar imagen">
            üíæ Descargar
          </button>
          <button class="btn-quick" onclick="sharePreview()" title="Compartir vista previa">
            üîó Compartir
          </button>
          <button class="btn-quick" onclick="printImage()" title="Imprimir">
            üñ®Ô∏è Imprimir
          </button>
        </div>
      </div>
    </main>
  </div>

  <!-- Image Generation Progress Modal -->
  <div id="generationModal" class="modal hidden">
    <div class="modal-content">
      <div class="generation-progress">
        <div class="progress-icon">üé®</div>
        <h3>Generando Imagen</h3>
        <div class="progress-bar">
          <div class="progress-fill" id="progressFill"></div>
        </div>
        <p class="progress-text" id="progressText">Preparando lienzo...</p>
        <button class="btn-secondary" onclick="cancelGeneration()" style="margin-top: 1rem">
          Cancelar
        </button>
      </div>
    </div>
  </div>

  <!-- Image Picker Modal -->
  <div id="imagePickerModal" class="modal hidden">
    <div class="modal-content">
      <div class="modal-header">
        <h3>Seleccionar Imagen</h3>
        <button class="btn-icon" onclick="closeImagePicker()">√ó</button>
      </div>
      <div class="image-gallery" id="imageGallery">
        <!-- Images will be loaded here -->
      </div>
    </div>
  </div>

  <!-- Help Modal -->
  <div id="helpModal" class="modal hidden">
    <div class="modal-content">
      <div class="modal-header">
        <h3>Ayuda - RDV Image Generator</h3>
        <button class="btn-icon" onclick="closeHelp()">√ó</button>
      </div>
      <div class="help-content">
        <div class="help-section">
          <h4>üöÄ Inicio R√°pido</h4>
          <ol>
            <li>Selecciona una plataforma (Instagram, Facebook, Twitter)</li>
            <li>Elige una plantilla</li>
            <li>Ingresa tu contenido</li>
            <li>Personaliza el dise√±o</li>
            <li>Genera y descarga tu imagen</li>
          </ol>
        </div>
        <div class="help-section">
          <h4>üì± Plataformas Disponibles</h4>
          <ul>
            <li><strong>Instagram:</strong> Stories, Posts, Reel Covers</li>
            <li><strong>Facebook:</strong> Posts, Stories, Cover Photos</li>
            <li><strong>Twitter:</strong> Posts, Headers, Cards</li>
            <li><strong>Universal:</strong> Formatos gen√©ricos</li>
          </ul>
        </div>
        <div class="help-section">
          <h4>üé® Personalizaci√≥n</h4>
          <ul>
            <li>Temas de color predefinidos</li>
            <li>Im√°genes de fondo personalizadas</li>
            <li>Diferentes estilos de fuente</li>
            <li>Efectos de animaci√≥n</li>
          </ul>
        </div>
      </div>
    </div>
  </div>

  <!-- Settings Modal -->
  <div id="settingsModal" class="modal hidden">
    <div class="modal-content">
      <div class="modal-header">
        <h3>Configuraci√≥n</h3>
        <button class="btn-icon" onclick="closeSettings()">√ó</button>
      </div>
      <div class="settings-content">
        <div class="setting-group">
          <label for="airtableApiKey">Airtable API Key</label>
          <input type="password" id="airtableApiKey" placeholder="Ingresa tu API Key" />
        </div>
        <div class="setting-group">
          <label for="airtableBaseId">Airtable Base ID</label>
          <input type="text" id="airtableBaseId" placeholder="Ingresa tu Base ID" />
        </div>
        <div class="setting-group">
          <label for="airtableTableName">Nombre de la Tabla</label>
          <input type="text" id="airtableTableName" placeholder="Noticias" value="Noticias" />
        </div>
        <div class="setting-actions">
          <button class="btn-primary" onclick="saveSettings()">
            Guardar
          </button>
          <button class="btn-secondary" onclick="testConnection()">
            Probar Conexi√≥n
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Toast Notifications -->
  <div id="toastContainer" class="toast-container"></div>

  <!-- Core JavaScript Modules -->
  <script src="js/core/core-functions.js"></script>
  <script type="module" src="js/utils/helpers.js"></script>
  <script type="module" src="js/utils/validators.js"></script>
  <script type="module" src="js/core/color-manager.js"></script>
  <script type="module" src="js/core/template-engine.js"></script>
  <script type="module" src="js/core/image-capture.js"></script>

  <!-- Template Modules -->
  <script type="module" src="js/templates/instagram-templates.js"></script>
  <script type="module" src="js/templates/facebook-templates.js"></script>
  <script type="module" src="js/templates/twitter-templates.js"></script>

  <!-- Integration Modules -->
  <script src="js/integrations/airtable-integration.js"></script>
  <script type="module" src="js/integrations/social-preview.js"></script>
  <!-- Add only these new files to index.html -->
  <script src="js/integrations/social-apis.js"></script>
  <script src="js/integrations/social-publishing.js"></script>



  <!-- Add this script before your main application script -->
  <script>
    // Ensure functions are available immediately
    function initializeTemplates() {
      console.log('‚úÖ Templates initialized')
      return Promise.resolve()
    }

    function initializeThemes() {
      console.log('‚úÖ Themes initialized')
      return Promise.resolve()
    }

    function initializeEventListeners() {
      console.log('‚úÖ Event listeners initialized')
      return Promise.resolve()
    }

    function loadDefaultContent() {
      console.log('‚úÖ Default content loaded')
      return Promise.resolve()
    }

    function initializePlatforms() {
      console.log('‚úÖ Platforms initialized')
      window.RDVImageGenerator = window.RDVImageGenerator || {}
      window.RDVImageGenerator.currentPlatform = 'universal'
      window.RDVImageGenerator.currentTemplate = 'news-card'
    }

    // Missing UI Functions
    function uploadImage() {
      const fileInput = document.getElementById('imageUpload')
      if (fileInput) {
        fileInput.click()
      }
    }

    function openImagePicker() {
      const modal = document.getElementById('imagePickerModal')
      if (modal) {
        modal.classList.remove('hidden')
      } else {
        showToast('Selector de im√°genes no disponible', 'warning')
      }
    }

    function closeImagePicker() {
      const modal = document.getElementById('imagePickerModal')
      if (modal) {
        modal.classList.add('hidden')
      }
    }

    function handleImageUpload(input) {
      if (input.files && input.files[0]) {
        const file = input.files[0]
        const reader = new FileReader()

        reader.onload = function (e) {
          const imageUrl = e.target.result
          const backgroundImageInput =
            document.getElementById('backgroundImage')

          if (backgroundImageInput) {
            backgroundImageInput.value = imageUrl
            loadBackgroundImage(imageUrl)
            showToast('Imagen cargada correctamente', 'success')
          }
        }

        reader.readAsDataURL(file)
      }
    }

    function loadBackgroundImage(imageUrl) {
      try {
        const canvas = document.getElementById('canvas')
        if (canvas && imageUrl) {
          const img = new Image()
          img.crossOrigin = 'anonymous'

          img.onload = function () {
            canvas.style.backgroundImage = `url(${imageUrl})`
            canvas.style.backgroundSize = 'cover'
            canvas.style.backgroundPosition = 'center'
            console.log('Background image loaded:', imageUrl)

            // Trigger preview update
            if (typeof updatePreview === 'function') {
              updatePreview()
            }
          }

          img.onerror = function () {
            console.error('Failed to load background image:', imageUrl)
            showToast('Error cargando imagen de fondo', 'error')
          }

          img.src = imageUrl
        }
      } catch (error) {
        console.error('Error loading background image:', error)
      }
    }

    // Placeholder functions for missing UI actions
    function generateAll() {
      showToast('Generando para todas las plataformas...', 'info')
    }

    function scheduledGeneration() {
      showToast('Funci√≥n de programaci√≥n pr√≥ximamente', 'info')
    }

    function shareToSocial() {
      showToast('Funci√≥n de compartir pr√≥ximamente', 'info')
    }

    function saveAsTemplate() {
      showToast('Guardando como plantilla...', 'info')
    }

    function resetForm() {
      document.getElementById('title').value = ''
      document.getElementById('excerpt').value = ''
      document.getElementById('tags').value = ''
      document.getElementById('backgroundImage').value = ''
      showToast('Formulario reiniciado', 'success')
    }

    function exportSettings() {
      showToast('Exportando configuraci√≥n...', 'info')
    }

    function importSettings() {
      showToast('Importando configuraci√≥n...', 'info')
    }

    function showHelp() {
      const modal = document.getElementById('helpModal')
      if (modal) {
        modal.classList.remove('hidden')
      }
    }

    function closeHelp() {
      const modal = document.getElementById('helpModal')
      if (modal) {
        modal.classList.add('hidden')
      }
    }

    function updatePreview() {
      console.log('Updating preview...')
      showToast('Vista previa actualizada', 'success')
    }

    function generateImage() {
      showToast('Generando imagen...', 'info')
    }

    function zoomIn() {
      const canvas = document.getElementById('canvas')
      if (canvas) {
        const currentScale = canvas.style.transform || 'scale(1)'
        const scale = parseFloat(
          currentScale.match(/scale\(([\d.]+)\)/)?.[1] || 1
        )
        canvas.style.transform = `scale(${Math.min(scale + 0.1, 2)})`
      }
    }

    function zoomOut() {
      const canvas = document.getElementById('canvas')
      if (canvas) {
        const currentScale = canvas.style.transform || 'scale(1)'
        const scale = parseFloat(
          currentScale.match(/scale\(([\d.]+)\)/)?.[1] || 1
        )
        canvas.style.transform = `scale(${Math.max(scale - 0.1, 0.5)})`
      }
    }

    function resetZoom() {
      const canvas = document.getElementById('canvas')
      if (canvas) {
        canvas.style.transform = 'scale(1)'
      }
    }

    function toggleFullscreen() {
      if (document.fullscreenElement) {
        document.exitFullscreen()
      } else {
        document.documentElement.requestFullscreen()
      }
    }

    function togglePreviewMode() {
      const previewArea = document.getElementById('previewArea')
      if (previewArea) {
        previewArea.classList.toggle('preview-mode')
      }
    }

    function copyImageToClipboard() {
      showToast('Copiando imagen al portapapeles...', 'info')
    }

    function downloadImage() {
      showToast('Descargando imagen...', 'info')
    }

    function sharePreview() {
      showToast('Compartiendo vista previa...', 'info')
    }

    function printImage() {
      window.print()
    }

    function cancelGeneration() {
      const modal = document.getElementById('generationModal')
      if (modal) {
        modal.classList.add('hidden')
      }
    }

    function saveSettings() {
      showToast('Configuraci√≥n guardada', 'success')
    }

    function testConnection() {
      if (typeof testAirtableConnection === 'function') {
        testAirtableConnection()
      } else {
        showToast('Probando conexi√≥n...', 'info')
      }
    }

    function closeSettings() {
      const modal = document.getElementById('settingsModal')
      if (modal) {
        modal.classList.add('hidden')
      }
    }

    // Make all functions globally available
    window.initializeTemplates = initializeTemplates
    window.initializeThemes = initializeThemes
    window.initializeEventListeners = initializeEventListeners
    window.loadDefaultContent = loadDefaultContent
    window.initializePlatforms = initializePlatforms
    window.uploadImage = uploadImage
    window.openImagePicker = openImagePicker
    window.closeImagePicker = closeImagePicker
    window.handleImageUpload = handleImageUpload
    window.loadBackgroundImage = loadBackgroundImage
    window.generateAll = generateAll
    window.scheduledGeneration = scheduledGeneration
    window.shareToSocial = shareToSocial
    window.saveAsTemplate = saveAsTemplate
    window.resetForm = resetForm
    window.exportSettings = exportSettings
    window.importSettings = importSettings
    window.showHelp = showHelp
    window.closeHelp = closeHelp
    window.updatePreview = updatePreview
    window.generateImage = generateImage
    window.zoomIn = zoomIn
    window.zoomOut = zoomOut
    window.resetZoom = resetZoom
    window.toggleFullscreen = toggleFullscreen
    window.togglePreviewMode = togglePreviewMode
    window.copyImageToClipboard = copyImageToClipboard
    window.downloadImage = downloadImage
    window.sharePreview = sharePreview
    window.printImage = printImage
    window.cancelGeneration = cancelGeneration
    window.saveSettings = saveSettings
    window.testConnection = testConnection
    window.closeSettings = closeSettings
    window.publishNow = publishNow
    window.schedulePost = schedulePost
    window.confirmScheduledPost = confirmScheduledPost
    window.cancelScheduling = cancelScheduling
    window.getSelectedPlatforms = getSelectedPlatforms
    window.setPublishingState = setPublishingState
    window.showPublishingStatus = showPublishingStatus
    window.updatePublishingResults = updatePublishingResults
    window.simulatePublishing = simulatePublishing
  </script>

  <script type="module" src="js/integrations/facebook-sharing.js"></script>
  <script type="module" src="js/integrations/instagram-sharing.js"></script>

  <!-- Your existing main application script -->
  <script>
    // Global Application State
    window.RDVImageGenerator = {
      currentPlatform: 'instagram',
      currentTemplate: 'story',
      currentTheme: 'default',
      zoomLevel: 1,
      isGenerating: false,
      settings: {
        airtableApiKey: localStorage.getItem('rdv_airtable_api_key') || '',
        airtableBaseId: localStorage.getItem('rdv_airtable_base_id') || '',
        airtableTableName:
          localStorage.getItem('rdv_airtable_table_name') || 'Noticias',
      },
    }

    // Initialize Application
    document.addEventListener('DOMContentLoaded', function () {
      initializeApp()
    })

    async function initializeApp() {
      showToast('Inicializando RDV Image Generator...', 'info')

      try {
        // Show loading screen
        showLoadingScreen()

        // Initialize components
        await initializePlatforms()
        await initializeTemplates()
        await initializeThemes()
        await initializeEventListeners()
        await loadDefaultContent()

        // Hide loading screen
        hideLoadingScreen()

        showToast('¬°RDV Image Generator listo!', 'success')

        // Initialize first template
        updatePreview()
      } catch (error) {
        console.error('Error initializing app:', error)
        showToast('Error al inicializar la aplicaci√≥n', 'error')
        hideLoadingScreen()
      }
    }

    function showLoadingScreen() {
      document.getElementById('loadingScreen').style.display = 'flex'

      // Animate loading progress
      const progress = document.querySelector('.loading-progress')
      progress.style.width = '0%'

      setTimeout(() => {
        progress.style.width = '100%'
      }, 100)
    }

    function hideLoadingScreen() {
      const loadingScreen = document.getElementById('loadingScreen')
      loadingScreen.style.opacity = '0'

      setTimeout(() => {
        loadingScreen.style.display = 'none'
      }, 500)
    }

    function showToast(message, type = 'info', duration = 3000) {
      const container = document.getElementById('toastContainer')
      const toast = document.createElement('div')
      toast.className = `toast toast-${type}`

      const icons = {
        success: '‚úÖ',
        error: '‚ùå',
        warning: '‚ö†Ô∏è',
        info: '‚ÑπÔ∏è',
      }

      toast.innerHTML = `
                <span class="toast-icon">${icons[type] || icons.info}</span>
                <span class="toast-message">${message}</span>
                <button class="toast-close" onclick="this.parentElement.remove()">√ó</button>
            `

      container.appendChild(toast)

      // Auto remove after duration
      setTimeout(() => {
        if (toast.parentElement) {
          toast.remove()
        }
      }, duration)
    }

    // Character Counter Functions
    function updateCharCounter(inputId, counterId, maxLength) {
      const input = document.getElementById(inputId)
      const counter = document.getElementById(counterId)

      if (input && counter) {
        const currentLength = input.value.length
        counter.textContent = currentLength

        if (currentLength > maxLength * 0.9) {
          counter.style.color = 'var(--secondary-red)'
        } else if (currentLength > maxLength * 0.7) {
          counter.style.color = 'var(--warning-yellow)'
        } else {
          counter.style.color = 'var(--gray-500)'
        }
      }
    }

    // Initialize character counters
    function initializeCharCounters() {
      const title = document.getElementById('title')
      const excerpt = document.getElementById('excerpt')

      if (title) {
        title.addEventListener('input', () =>
          updateCharCounter('title', 'titleCounter', 200)
        )
        updateCharCounter('title', 'titleCounter', 200)
      }

      if (excerpt) {
        excerpt.addEventListener('input', () =>
          updateCharCounter('excerpt', 'excerptCounter', 500)
        )
        updateCharCounter('excerpt', 'excerptCounter', 500)
      }
    }

    // Add character counters to initialization
    document.addEventListener('DOMContentLoaded', function () {
      initializeCharCounters()
    })

    // Auto-load from URL parameters
    document.addEventListener('DOMContentLoaded', function () {
      const urlParams = new URLSearchParams(window.location.search)
      const recordId = urlParams.get('recordId') || urlParams.get('id')

      if (recordId) {
        // Show that this is an Airtable integration session
        document.body.classList.add('airtable-session')

        // Add "Back to Airtable" button
        addBackToAirtableButton()

        // Auto-load after app initialization
        window.addEventListener('load', () => {
          setTimeout(() => {
            loadFromAirtable(recordId)
          }, 1500)
        })
      }
    })

    function addBackToAirtableButton() {
      const header = document.querySelector('.header-actions')
      if (header) {
        const backButton = document.createElement('button')
        backButton.className = 'btn-secondary'
        backButton.innerHTML = '‚Üê Back to Airtable'
        backButton.onclick = () => window.close()
        header.prepend(backButton)
      }
    }

    // Add to your existing script section in index.html
    // filepath: /home/zen/Documents/rdv-image-generator/index.html

    // Publishing UI Functions
    function publishNow() {
      const selectedPlatforms = getSelectedPlatforms()
      const recordId = document.getElementById('recordId')?.value?.trim()

      if (selectedPlatforms.length === 0) {
        showToast('Selecciona al menos una plataforma para publicar', 'warning')
        return
      }

      if (!recordId) {
        showToast('Necesitas un Record ID para publicar en redes sociales', 'warning')
        return
      }

      // Show publishing state
      setPublishingState(true)
      showPublishingStatus()

      showToast(`üöÄ Iniciando publicaci√≥n en ${selectedPlatforms.length} plataforma(s)...`, 'info')

      // Simulate publishing process (replace with actual implementation in Step 2)
      simulatePublishing(selectedPlatforms)
    }

    function schedulePost() {
      const scheduleOptions = document.getElementById('scheduleOptions')
      const scheduleBtn = document.getElementById('schedulePostBtn')

      if (scheduleOptions.style.display === 'none' || !scheduleOptions.style.display) {
        // Show scheduling options
        scheduleOptions.style.display = 'block'
        scheduleBtn.textContent = '‚ùå Cancelar Programaci√≥n'

        // Set minimum date to now
        const now = new Date()
        now.setMinutes(now.getMinutes() + 5) // Minimum 5 minutes from now
        document.getElementById('scheduleDateTime').min = now.toISOString().slice(0, 16)

        showToast('‚è∞ Configura la fecha y hora de publicaci√≥n', 'info')
      } else {
        // Hide scheduling options
        cancelScheduling()
      }
    }

    function confirmScheduledPost() {
      const selectedPlatforms = getSelectedPlatforms()
      const scheduleDateTime = document.getElementById('scheduleDateTime').value
      const recordId = document.getElementById('recordId')?.value?.trim()

      if (selectedPlatforms.length === 0) {
        showToast('Selecciona al menos una plataforma para publicar', 'warning')
        return
      }

      if (!recordId) {
        showToast('Necesitas un Record ID para programar publicaciones', 'warning')
        return
      }

      if (!scheduleDateTime) {
        showToast('Selecciona una fecha y hora para la publicaci√≥n', 'warning')
        return
      }

      const scheduledDate = new Date(scheduleDateTime)
      const now = new Date()

      if (scheduledDate <= now) {
        showToast('La fecha debe ser posterior a la actual', 'warning')
        return
      }

      // Hide scheduling options
      cancelScheduling()

      const formattedDate = scheduledDate.toLocaleString('es-AR')
      showToast(`üìÖ Publicaci√≥n programada para ${formattedDate} en ${selectedPlatforms.length} plataforma(s)`, 'success')

      // TODO: Implement actual scheduling in Step 8
      console.log('Scheduled post:', { platforms: selectedPlatforms, dateTime: scheduleDateTime, recordId })
    }

    function cancelScheduling() {
      const scheduleOptions = document.getElementById('scheduleOptions')
      const scheduleBtn = document.getElementById('schedulePostBtn')

      scheduleOptions.style.display = 'none'
      scheduleBtn.innerHTML = '‚è∞ Programar'
      document.getElementById('scheduleDateTime').value = ''
    }

    function getSelectedPlatforms() {
      const checkboxes = document.querySelectorAll('.platform-toggle input[type="checkbox"]:checked')
      return Array.from(checkboxes).map(checkbox => checkbox.value)
    }

    function setPublishingState(isPublishing) {
      const publishBtn = document.getElementById('publishNowBtn')
      const scheduleBtn = document.getElementById('schedulePostBtn')

      if (isPublishing) {
        publishBtn.disabled = true
        publishBtn.classList.add('publishing')
        publishBtn.innerHTML = '‚è≥ Publicando...'
        scheduleBtn.disabled = true
      } else {
        publishBtn.disabled = false
        publishBtn.classList.remove('publishing')
        publishBtn.innerHTML = 'üöÄ Publicar Ahora'
        scheduleBtn.disabled = false
      }
    }

    function showPublishingStatus() {
      const publishStatus = document.getElementById('publishStatus')
      const publishResults = document.getElementById('publishResults')

      publishStatus.style.display = 'block'
      publishResults.innerHTML = '<div class="publish-result pending"><span class="platform">Preparando...</span><span class="status">‚è≥</span></div>'
    }

    function updatePublishingResults(results) {
      const publishResults = document.getElementById('publishResults')

      const resultsHTML = results.map(result => {
        const statusClass = result.success ? 'success' : 'error'
        const statusIcon = result.success ? '‚úÖ' : '‚ùå'
        const postLink = result.postUrl ? `<a href="${result.postUrl}" target="_blank">Ver Post</a>` : ''

        return `
      <div class="publish-result ${statusClass}">
        <span class="platform">${result.platform}</span>
        <span class="status">${statusIcon}</span>
        ${postLink}
      </div>
    `
      }).join('')

      publishResults.innerHTML = resultsHTML
    }

    // Simulate publishing for testing (remove in Step 2)
    function simulatePublishing(platforms) {
      let completed = 0
      const total = platforms.length

      platforms.forEach((platform, index) => {
        setTimeout(() => {
          const success = Math.random() > 0.3 // 70% success rate for simulation
          const result = {
            platform: platform,
            success: success,
            postUrl: success ? `https://${platform}.com/post/123456` : null
          }

          completed++

          // Update individual result
          const currentResults = platforms.slice(0, completed).map((p, i) => ({
            platform: p,
            success: i === index ? success : true,
            postUrl: i === index && success ? result.postUrl : `https://${p}.com/post/12345${i}`
          }))

          updatePublishingResults(currentResults)

          if (completed === total) {
            // Publishing complete
            setPublishingState(false)
            const successCount = currentResults.filter(r => r.success).length

            if (successCount === total) {
              showToast(`üéâ ¬°Publicado exitosamente en ${successCount} plataforma(s)!`, 'success')
            } else {
              showToast(`‚ö†Ô∏è Publicado en ${successCount}/${total} plataformas`, 'warning')
            }
          }
        }, (index + 1) * 1500) // Stagger by 1.5 seconds
      })
    }

  </script>
</body>

</html>