<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>RDV Image Generator Pro</title>
    <meta
      name="description"
      content="Professional social media image generator for Radio del Volga news content"
    />
    <meta
      name="keywords"
      content="image generator, social media, news, rdv, canvas"
    />
    <meta name="author" content="Radio del Volga" />

    <!-- Favicon -->
    <link
      rel="icon"
      href="assets/images/logos/rdv-logo.svg"
      type="image/svg+xml"
    />
    <link rel="apple-touch-icon" href="assets/images/logos/rdv-logo.svg" />

    <!-- External Dependencies -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/dom-to-image/2.6.0/dom-to-image.min.js"></script>

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&family=Playfair+Display:wght@400;500;600;700;800;900&family=Roboto:wght@300;400;500;700;900&display=swap"
      rel="stylesheet"
    />

    <!-- Local Styles -->
    <link rel="stylesheet" href="css/base.css" />
    <link rel="stylesheet" href="css/components.css" />
    <link rel="stylesheet" href="css/templates.css" />
    <link rel="stylesheet" href="css/responsive.css" />

    <!-- Theme Styles -->
    <link rel="stylesheet" href="assets/styles/themes/default.css" />
    <link rel="stylesheet" href="assets/styles/animations/entrance.css" />
    <link rel="stylesheet" href="assets/styles/animations/floating.css" />

    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json" />
    <meta name="theme-color" content="#667eea" />
  </head>
  <body>
    <!-- Loading Screen -->
    <div id="loadingScreen" class="loading-screen">
      <div class="loading-content">
        <div class="loading-logo">
          <img src="assets/images/logos/rdv-logo.svg" alt="RDV" />
        </div>
        <div class="loading-text">Cargando RDV Image Generator...</div>
        <div class="loading-bar">
          <div class="loading-progress"></div>
        </div>
      </div>
    </div>

    <!-- Header -->
    <header class="header" id="mainHeader">
      <div class="header-content">
        <div class="logo">
          <img
            src="assets/images/logos/rdv-logo.svg"
            alt="RDV"
            width="40"
            height="40"
          />
          <span>Image Generator Pro</span>
          <span class="version-badge">v1.0</span>
        </div>
        <div class="header-actions">
          <button
            class="btn-secondary"
            onclick="exportSettings()"
            title="Exportar configuraciÃ³n"
          >
            <span>âš™ï¸</span>
            <span>Exportar Config</span>
          </button>
          <button
            class="btn-secondary"
            onclick="importSettings()"
            title="Importar configuraciÃ³n"
          >
            <span>ğŸ“¥</span>
            <span>Importar Config</span>
          </button>
          <button class="btn-secondary" onclick="showHelp()" title="Ayuda">
            <span>â“</span>
            <span>Ayuda</span>
          </button>
        </div>
      </div>
    </header>

    <!-- Main Container -->
    <div class="main-container" id="mainContainer">
      <!-- Control Panel -->
      <aside class="control-panel" id="controlPanel">
        <!-- Platform & Template Section -->
        <div class="panel-section">
          <h3>ğŸ¯ Plataforma & Plantilla</h3>

          <!-- Platform Selector -->
          <div class="platform-selector" id="platformSelector">
            <button
              class="platform-btn active"
              data-platform="instagram"
              title="Instagram"
            >
              <span class="platform-icon">ğŸ“·</span>
              <span>Instagram</span>
            </button>
            <button
              class="platform-btn"
              data-platform="facebook"
              title="Facebook"
            >
              <span class="platform-icon">ğŸ‘¥</span>
              <span>Facebook</span>
            </button>
            <button
              class="platform-btn"
              data-platform="twitter"
              title="Twitter"
            >
              <span class="platform-icon">ğŸ¦</span>
              <span>Twitter</span>
            </button>
            <button
              class="platform-btn"
              data-platform="universal"
              title="Universal"
            >
              <span class="platform-icon">ğŸŒ</span>
              <span>Universal</span>
            </button>
          </div>

          <!-- Template Selector -->
          <div class="template-selector" id="templateSelector">
            <!-- Templates will be loaded dynamically -->
          </div>
        </div>

        <!-- Content Section -->
        <div class="panel-section">
          <h3>ğŸ“ Contenido</h3>

          <div class="form-group">
            <label for="recordId">ID de Registro Airtable</label>
            <div class="input-group">
              <input
                type="text"
                id="recordId"
                placeholder="Ingresa el ID del registro"
                autocomplete="off"
              />
              <button
                class="btn-icon"
                onclick="loadFromAirtable()"
                title="Cargar desde Airtable"
              >
                ğŸ“¥
              </button>
            </div>
            <small class="form-help"
              >Opcional: Carga automÃ¡tica desde Airtable</small
            >
          </div>

          <div class="form-group">
            <label for="title">TÃ­tulo</label>
            <textarea
              id="title"
              rows="2"
              placeholder="Ingresa el tÃ­tulo del artÃ­culo"
              maxlength="200"
            >
Argentina lidera innovaciÃ³n en tecnologÃ­a sustentable</textarea
            >
            <div class="char-counter">
              <span id="titleCounter">0</span>/200 caracteres
            </div>
          </div>

          <div class="form-group">
            <label for="excerpt">Resumen</label>
            <textarea
              id="excerpt"
              rows="3"
              placeholder="Ingresa el resumen del artÃ­culo"
              maxlength="500"
            >
Un nuevo estudio revela que Argentina se posiciona como lÃ­der regional en el desarrollo de tecnologÃ­as sustentables, con inversiones que superan los USD 2.000 millones.</textarea
            >
            <div class="char-counter">
              <span id="excerptCounter">0</span>/500 caracteres
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label for="source">Fuente</label>
              <input
                type="text"
                id="source"
                placeholder="Nombre de la fuente"
                value="RDV Noticias"
                maxlength="50"
              />
            </div>

            <div class="form-group">
              <label for="author">Autor</label>
              <input
                type="text"
                id="author"
                placeholder="Nombre del autor"
                value="RedacciÃ³n RDV"
                maxlength="50"
              />
            </div>
          </div>

          <div class="form-group">
            <label for="tags">Etiquetas</label>
            <input
              type="text"
              id="tags"
              placeholder="etiqueta1, etiqueta2, etiqueta3"
              value="tecnologÃ­a, sustentabilidad, argentina"
              maxlength="100"
            />
            <small class="form-help">Separadas por comas</small>
          </div>

          <div class="form-group">
            <label for="category">CategorÃ­a</label>
            <select id="category">
              <option value="general">General</option>
              <option value="politica">PolÃ­tica</option>
              <option value="economia">EconomÃ­a</option>
              <option value="tecnologia" selected>TecnologÃ­a</option>
              <option value="deportes">Deportes</option>
              <option value="cultura">Cultura</option>
              <option value="internacionales">Internacionales</option>
              <option value="sociedad">Sociedad</option>
            </select>
          </div>
        </div>

        <!-- Design Section -->
        <div class="panel-section">
          <h3>ğŸ¨ DiseÃ±o</h3>

          <div class="form-group">
            <label>Tema de Color</label>
            <div class="color-themes" id="colorThemes">
              <div class="color-theme active" data-theme="default">
                <div
                  class="color-preview"
                  style="
                    background: linear-gradient(
                      135deg,
                      #667eea 0%,
                      #764ba2 100%
                    );
                  "
                ></div>
                <span>Default</span>
              </div>
              <div class="color-theme" data-theme="news">
                <div
                  class="color-preview"
                  style="
                    background: linear-gradient(
                      135deg,
                      #ff416c 0%,
                      #ff4b2b 100%
                    );
                  "
                ></div>
                <span>Noticias</span>
              </div>
              <div class="color-theme" data-theme="tech">
                <div
                  class="color-preview"
                  style="
                    background: linear-gradient(
                      135deg,
                      #4facfe 0%,
                      #00f2fe 100%
                    );
                  "
                ></div>
                <span>Tech</span>
              </div>
              <div class="color-theme" data-theme="business">
                <div
                  class="color-preview"
                  style="
                    background: linear-gradient(
                      135deg,
                      #43e97b 0%,
                      #38f9d7 100%
                    );
                  "
                ></div>
                <span>Business</span>
              </div>
              <div class="color-theme" data-theme="sports">
                <div
                  class="color-preview"
                  style="
                    background: linear-gradient(
                      135deg,
                      #fa709a 0%,
                      #fee140 100%
                    );
                  "
                ></div>
                <span>Deportes</span>
              </div>
              <div class="color-theme" data-theme="culture">
                <div
                  class="color-preview"
                  style="
                    background: linear-gradient(
                      135deg,
                      #a8edea 0%,
                      #fed6e3 100%
                    );
                  "
                ></div>
                <span>Cultura</span>
              </div>
            </div>
          </div>

          <div class="form-group">
            <label for="backgroundImage">Imagen de Fondo</label>
            <div class="input-group">
              <input
                type="text"
                id="backgroundImage"
                placeholder="https://ejemplo.com/imagen.jpg"
              />
              <button
                class="btn-icon"
                onclick="openImagePicker()"
                title="Explorar imÃ¡genes"
              >
                ğŸ–¼ï¸
              </button>
              <button
                class="btn-icon"
                onclick="uploadImage()"
                title="Subir imagen"
              >
                ğŸ“¤
              </button>
            </div>
            <input
              type="file"
              id="imageUpload"
              accept="image/*"
              style="display: none"
              onchange="handleImageUpload(this)"
            />
          </div>

          <div class="form-row">
            <div class="form-group">
              <label for="fontStyle">Estilo de Fuente</label>
              <select id="fontStyle">
                <option value="inter">Inter (Moderno)</option>
                <option value="playfair">Playfair Display (Elegante)</option>
                <option value="roboto">Roboto (Limpio)</option>
                <option value="custom">Fuente Personalizada</option>
              </select>
            </div>

            <div class="form-group">
              <label for="animationStyle">Estilo de AnimaciÃ³n</label>
              <select id="animationStyle">
                <option value="none">Ninguna</option>
                <option value="fade">Fade In</option>
                <option value="slide">Slide In</option>
                <option value="float">Elementos Flotantes</option>
                <option value="pulse">Efecto Pulse</option>
              </select>
            </div>
          </div>

          <div class="form-group">
            <label for="imageQuality">Calidad de Imagen</label>
            <select id="imageQuality">
              <option value="standard">EstÃ¡ndar (Web)</option>
              <option value="high" selected>Alta (Print)</option>
              <option value="ultra">Ultra (4K)</option>
            </select>
          </div>
        </div>

        <!-- Actions Section -->
        <div class="panel-section">
          <h3>âš¡ Acciones</h3>

          <button
            class="btn-primary full-width"
            onclick="updatePreview()"
            title="Actualizar vista previa"
          >
            ğŸ”„ Actualizar Vista Previa
          </button>

          <button
            class="btn-primary full-width"
            onclick="generateImage()"
            title="Generar imagen"
          >
            ğŸ“· Generar Imagen
          </button>

          <div class="btn-group">
            <button
              class="btn-secondary"
              onclick="generateAll()"
              title="Generar para todas las plataformas"
            >
              ğŸ“Š Todas las Plataformas
            </button>
            <button
              class="btn-secondary"
              onclick="scheduledGeneration()"
              title="Programar generaciÃ³n"
            >
              â° Programar
            </button>
          </div>

          <div class="btn-group">
            <button
              class="btn-secondary"
              onclick="uploadToAirtable()"
              title="Guardar en Airtable"
            >
              â˜ï¸ Guardar en Airtable
            </button>
            <button
              class="btn-secondary"
              onclick="shareToSocial()"
              title="Compartir directamente"
            >
              ğŸš€ Compartir Directo
            </button>
          </div>

          <div class="btn-group">
            <button
              class="btn-secondary"
              onclick="saveAsTemplate()"
              title="Guardar como plantilla"
            >
              ğŸ’¾ Guardar Plantilla
            </button>
            <button
              class="btn-secondary"
              onclick="resetForm()"
              title="Reiniciar formulario"
            >
              ğŸ”„ Reiniciar
            </button>
          </div>
        </div>
      </aside>

      <!-- Preview Area -->
      <main class="preview-area" id="previewArea">
        <div class="preview-header">
          <div class="preview-info">
            <span class="platform-name" id="currentPlatform">Instagram</span>
            <span class="template-name" id="currentTemplate"
              >Story Template</span
            >
            <span class="dimensions" id="currentDimensions">1080 Ã— 1920</span>
          </div>

          <div class="preview-actions">
            <button class="btn-icon" onclick="zoomIn()" title="Acercar">
              ğŸ”+
            </button>
            <button class="btn-icon" onclick="zoomOut()" title="Alejar">
              ğŸ”-
            </button>
            <button
              class="btn-icon"
              onclick="resetZoom()"
              title="Restablecer zoom"
            >
              âš¡
            </button>
            <button
              class="btn-icon"
              onclick="toggleFullscreen()"
              title="Pantalla completa"
            >
              â›¶
            </button>
            <button
              class="btn-icon"
              onclick="togglePreviewMode()"
              title="Modo de vista previa"
            >
              ğŸ‘ï¸
            </button>
          </div>
        </div>

        <div class="preview-container" id="previewContainer">
          <div class="canvas-wrapper" id="canvasWrapper">
            <div id="canvas" class="template-canvas">
              <!-- Template content will be loaded here -->
              <div class="placeholder-content">
                <div class="placeholder-icon">ğŸ¨</div>
                <h3>Selecciona una plantilla para comenzar</h3>
                <p>Elige una plataforma y plantilla para ver la vista previa</p>
              </div>
            </div>
          </div>
        </div>

        <div class="preview-footer">
          <div class="generation-status">
            <span class="status-indicator ready" id="statusIndicator"></span>
            <span id="statusText">Listo para generar</span>
          </div>

          <div class="quick-actions">
            <button
              class="btn-quick"
              onclick="copyImageToClipboard()"
              title="Copiar al portapapeles"
            >
              ğŸ“‹ Copiar
            </button>
            <button
              class="btn-quick"
              onclick="downloadImage()"
              title="Descargar imagen"
            >
              ğŸ’¾ Descargar
            </button>
            <button
              class="btn-quick"
              onclick="sharePreview()"
              title="Compartir vista previa"
            >
              ğŸ”— Compartir
            </button>
            <button class="btn-quick" onclick="printImage()" title="Imprimir">
              ğŸ–¨ï¸ Imprimir
            </button>
          </div>
        </div>
      </main>
    </div>

    <!-- Image Generation Progress Modal -->
    <div id="generationModal" class="modal hidden">
      <div class="modal-content">
        <div class="generation-progress">
          <div class="progress-icon">ğŸ¨</div>
          <h3>Generando Imagen</h3>
          <div class="progress-bar">
            <div class="progress-fill" id="progressFill"></div>
          </div>
          <p class="progress-text" id="progressText">Preparando lienzo...</p>
          <button
            class="btn-secondary"
            onclick="cancelGeneration()"
            style="margin-top: 1rem"
          >
            Cancelar
          </button>
        </div>
      </div>
    </div>

    <!-- Image Picker Modal -->
    <div id="imagePickerModal" class="modal hidden">
      <div class="modal-content">
        <div class="modal-header">
          <h3>Seleccionar Imagen</h3>
          <button class="btn-icon" onclick="closeImagePicker()">Ã—</button>
        </div>
        <div class="image-gallery" id="imageGallery">
          <!-- Images will be loaded here -->
        </div>
      </div>
    </div>

    <!-- Help Modal -->
    <div id="helpModal" class="modal hidden">
      <div class="modal-content">
        <div class="modal-header">
          <h3>Ayuda - RDV Image Generator</h3>
          <button class="btn-icon" onclick="closeHelp()">Ã—</button>
        </div>
        <div class="help-content">
          <div class="help-section">
            <h4>ğŸš€ Inicio RÃ¡pido</h4>
            <ol>
              <li>Selecciona una plataforma (Instagram, Facebook, Twitter)</li>
              <li>Elige una plantilla</li>
              <li>Ingresa tu contenido</li>
              <li>Personaliza el diseÃ±o</li>
              <li>Genera y descarga tu imagen</li>
            </ol>
          </div>
          <div class="help-section">
            <h4>ğŸ“± Plataformas Disponibles</h4>
            <ul>
              <li><strong>Instagram:</strong> Stories, Posts, Reel Covers</li>
              <li><strong>Facebook:</strong> Posts, Stories, Cover Photos</li>
              <li><strong>Twitter:</strong> Posts, Headers, Cards</li>
              <li><strong>Universal:</strong> Formatos genÃ©ricos</li>
            </ul>
          </div>
          <div class="help-section">
            <h4>ğŸ¨ PersonalizaciÃ³n</h4>
            <ul>
              <li>Temas de color predefinidos</li>
              <li>ImÃ¡genes de fondo personalizadas</li>
              <li>Diferentes estilos de fuente</li>
              <li>Efectos de animaciÃ³n</li>
            </ul>
          </div>
        </div>
      </div>
    </div>

    <!-- Settings Modal -->
    <div id="settingsModal" class="modal hidden">
      <div class="modal-content">
        <div class="modal-header">
          <h3>ConfiguraciÃ³n</h3>
          <button class="btn-icon" onclick="closeSettings()">Ã—</button>
        </div>
        <div class="settings-content">
          <div class="setting-group">
            <label for="airtableApiKey">Airtable API Key</label>
            <input
              type="password"
              id="airtableApiKey"
              placeholder="Ingresa tu API Key"
            />
          </div>
          <div class="setting-group">
            <label for="airtableBaseId">Airtable Base ID</label>
            <input
              type="text"
              id="airtableBaseId"
              placeholder="Ingresa tu Base ID"
            />
          </div>
          <div class="setting-group">
            <label for="airtableTableName">Nombre de la Tabla</label>
            <input
              type="text"
              id="airtableTableName"
              placeholder="Noticias"
              value="Noticias"
            />
          </div>
          <div class="setting-actions">
            <button class="btn-primary" onclick="saveSettings()">
              Guardar
            </button>
            <button class="btn-secondary" onclick="testConnection()">
              Probar ConexiÃ³n
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Toast Notifications -->
    <div id="toastContainer" class="toast-container"></div>

    <!-- Core JavaScript Modules -->
    <script src="js/core/core-functions.js"></script>
    <script type="module" src="js/utils/helpers.js"></script>
    <script type="module" src="js/utils/validators.js"></script>
    <script type="module" src="js/core/color-manager.js"></script>
    <script type="module" src="js/core/template-engine.js"></script>
    <script type="module" src="js/core/image-capture.js"></script>

    <!-- Template Modules -->
    <script type="module" src="js/templates/instagram-templates.js"></script>
    <script type="module" src="js/templates/facebook-templates.js"></script>
    <script type="module" src="js/templates/twitter-templates.js"></script>

    <!-- Integration Modules -->
    <script
      type="module"
      src="js/integrations/airtable-integration.js"
    ></script>
    <script type="module" src="js/integrations/social-preview.js"></script>

    <!-- Add this script before your main application script -->
    <script>
      // Ensure functions are available immediately
      function initializeTemplates() {
        console.log('âœ… Templates initialized')
        return Promise.resolve()
      }

      function initializeThemes() {
        console.log('âœ… Themes initialized')
        return Promise.resolve()
      }

      function initializeEventListeners() {
        console.log('âœ… Event listeners initialized')
        return Promise.resolve()
      }

      function loadDefaultContent() {
        console.log('âœ… Default content loaded')
        return Promise.resolve()
      }

      function initializePlatforms() {
        console.log('âœ… Platforms initialized')
        window.RDVImageGenerator = window.RDVImageGenerator || {}
        window.RDVImageGenerator.currentPlatform = 'universal'
        window.RDVImageGenerator.currentTemplate = 'news-card'
      }

      // Make globally available
      window.initializeTemplates = initializeTemplates
      window.initializeThemes = initializeThemes
      window.initializeEventListeners = initializeEventListeners
      window.loadDefaultContent = loadDefaultContent
      window.initializePlatforms = initializePlatforms
    </script>

    <!-- Your existing main application script -->
    <script>
      // Global Application State
      window.RDVImageGenerator = {
        currentPlatform: 'instagram',
        currentTemplate: 'story',
        currentTheme: 'default',
        zoomLevel: 1,
        isGenerating: false,
        settings: {
          airtableApiKey: localStorage.getItem('rdv_airtable_api_key') || '',
          airtableBaseId: localStorage.getItem('rdv_airtable_base_id') || '',
          airtableTableName:
            localStorage.getItem('rdv_airtable_table_name') || 'Noticias',
        },
      }

      // Initialize Application
      document.addEventListener('DOMContentLoaded', function () {
        initializeApp()
      })

      async function initializeApp() {
        showToast('Inicializando RDV Image Generator...', 'info')

        try {
          // Show loading screen
          showLoadingScreen()

          // Initialize components
          await initializePlatforms()
          await initializeTemplates()
          await initializeThemes()
          await initializeEventListeners()
          await loadDefaultContent()

          // Hide loading screen
          hideLoadingScreen()

          showToast('Â¡RDV Image Generator listo!', 'success')

          // Initialize first template
          updatePreview()
        } catch (error) {
          console.error('Error initializing app:', error)
          showToast('Error al inicializar la aplicaciÃ³n', 'error')
          hideLoadingScreen()
        }
      }

      function showLoadingScreen() {
        document.getElementById('loadingScreen').style.display = 'flex'

        // Animate loading progress
        const progress = document.querySelector('.loading-progress')
        progress.style.width = '0%'

        setTimeout(() => {
          progress.style.width = '100%'
        }, 100)
      }

      function hideLoadingScreen() {
        const loadingScreen = document.getElementById('loadingScreen')
        loadingScreen.style.opacity = '0'

        setTimeout(() => {
          loadingScreen.style.display = 'none'
        }, 500)
      }

      function showToast(message, type = 'info', duration = 3000) {
        const container = document.getElementById('toastContainer')
        const toast = document.createElement('div')
        toast.className = `toast toast-${type}`

        const icons = {
          success: 'âœ…',
          error: 'âŒ',
          warning: 'âš ï¸',
          info: 'â„¹ï¸',
        }

        toast.innerHTML = `
                <span class="toast-icon">${icons[type] || icons.info}</span>
                <span class="toast-message">${message}</span>
                <button class="toast-close" onclick="this.parentElement.remove()">Ã—</button>
            `

        container.appendChild(toast)

        // Auto remove after duration
        setTimeout(() => {
          if (toast.parentElement) {
            toast.remove()
          }
        }, duration)
      }

      // Character Counter Functions
      function updateCharCounter(inputId, counterId, maxLength) {
        const input = document.getElementById(inputId)
        const counter = document.getElementById(counterId)

        if (input && counter) {
          const currentLength = input.value.length
          counter.textContent = currentLength

          if (currentLength > maxLength * 0.9) {
            counter.style.color = 'var(--secondary-red)'
          } else if (currentLength > maxLength * 0.7) {
            counter.style.color = 'var(--warning-yellow)'
          } else {
            counter.style.color = 'var(--gray-500)'
          }
        }
      }

      // Initialize character counters
      function initializeCharCounters() {
        const title = document.getElementById('title')
        const excerpt = document.getElementById('excerpt')

        if (title) {
          title.addEventListener('input', () =>
            updateCharCounter('title', 'titleCounter', 200)
          )
          updateCharCounter('title', 'titleCounter', 200)
        }

        if (excerpt) {
          excerpt.addEventListener('input', () =>
            updateCharCounter('excerpt', 'excerptCounter', 500)
          )
          updateCharCounter('excerpt', 'excerptCounter', 500)
        }
      }

      // Add character counters to initialization
      document.addEventListener('DOMContentLoaded', function () {
        initializeCharCounters()
      })

      // Auto-load from URL parameters
      document.addEventListener('DOMContentLoaded', function () {
        const urlParams = new URLSearchParams(window.location.search)
        const recordId = urlParams.get('recordId') || urlParams.get('id')

        if (recordId) {
          // Show that this is an Airtable integration session
          document.body.classList.add('airtable-session')

          // Add "Back to Airtable" button
          addBackToAirtableButton()

          // Auto-load after app initialization
          window.addEventListener('load', () => {
            setTimeout(() => {
              loadFromAirtable(recordId)
            }, 1500)
          })
        }
      })

      function addBackToAirtableButton() {
        const header = document.querySelector('.header-actions')
        if (header) {
          const backButton = document.createElement('button')
          backButton.className = 'btn-secondary'
          backButton.innerHTML = 'â† Back to Airtable'
          backButton.onclick = () => window.close()
          header.prepend(backButton)
        }
      }
    </script>
  </body>
</html>
